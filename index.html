<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sky Tap Shooter - Fullscreen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        #game-container {
            width: 100%;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }
        
        #ad-container {
            width: 100%;
            height: 90px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 3px solid #fff;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
        }
        
        #ad-placeholder {
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 10px;
        }
        
        canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
    <!-- Ad Container -->
    <div id="ad-container">
        <div id="ad-placeholder">
            ðŸ“¢ Advertisement Space - Your Ad Here! 728x90
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    
    <script>
        class Start extends Phaser.Scene {
            constructor() {
                super({ key: 'Start' });
            }

            preload() {
                this.load.image('player', 'assets/Pesawat.png');
                this.load.image('logo', 'assets/NameGame.png');
                this.load.image('playButton', 'assets/Play.png');
                this.load.image('settingButton', 'assets/Setting.png');
                this.load.image('background', 'assets/BackgroundGame.png');
            }

            create() {
                const centerX = this.cameras.main.width;
                const centerY = this.cameras.main.height / 2;
                
                // Background image
                this.background = this.add.image(this.cameras.main.width / 2, centerY, 'background');
                this.background.setDisplaySize(this.cameras.main.width, this.cameras.main.height);
                this.background.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                this.background.setDepth(-10);
                
                // Coba load logo, kalau gagal pakai text
                if (this.textures.exists('logo')) {
                    const logo = this.add.image(this.cameras.main.width / 2, centerY - 180, 'logo');
                    logo.setScale(1); // Diperkecil dari 2 jadi 1
                    logo.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                } else {
                    // Fallback ke text kalau image tidak load
                    this.add.text(this.cameras.main.width / 2, centerY - 200, 'SKY TAP SHOOTER', {
                        fontSize: '64px',
                        fill: '#00ff00',
                        fontStyle: 'bold',
                        stroke: '#000',
                        strokeThickness: 6
                    }).setOrigin(0.5);
                }
                
                // Play button (image)
                const startButton = this.add.image(this.cameras.main.width / 2, centerY, 'playButton');
                startButton.setScale(2);
                startButton.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                startButton.setInteractive({ useHandCursor: true });
                
                // Hover effect
                startButton.on('pointerover', () => {
                    startButton.setScale(2.1);
                });
                
                startButton.on('pointerout', () => {
                    startButton.setScale(2);
                });
                
                startButton.on('pointerdown', () => {
                    this.scene.start('Main');
                });
                
                // Settings button (image)
                const settingsButton = this.add.image(this.cameras.main.width / 2, centerY + 100, 'settingButton');
                settingsButton.setScale(2);
                settingsButton.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                settingsButton.setInteractive({ useHandCursor: true });
                
                // Hover effect
                settingsButton.on('pointerover', () => {
                    settingsButton.setScale(2.1);
                });
                
                settingsButton.on('pointerout', () => {
                    settingsButton.setScale(2);
                });
                
                settingsButton.on('pointerdown', () => {
                    this.scene.start('Settings');
                });
            }
        }
    </script>
    
    <script>
        class Settings extends Phaser.Scene {
            constructor() {
                super({ key: 'Settings' });
            }

            preload() {
                this.load.image('background', 'assets/BackgroundGame.png');
            }

            create() {
                const centerX = this.cameras.main.width / 2;
                const centerY = this.cameras.main.height / 2;
                
                // Background image
                this.background = this.add.image(centerX, centerY, 'background');
                this.background.setDisplaySize(this.cameras.main.width, this.cameras.main.height);
                this.background.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                this.background.setDepth(-10);
                
                // Title
                this.add.text(centerX, centerY - 150, 'SETTINGS', {
                    fontSize: '48px',
                    fill: '#fff',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // Placeholder text
                this.add.text(centerX, centerY, 'Settings options will be added here', {
                    fontSize: '20px',
                    fill: '#888'
                }).setOrigin(0.5);
                
                // Back button
                const backButton = this.add.text(centerX, centerY + 150, 'BACK', {
                    fontSize: '28px',
                    fill: '#fff',
                    backgroundColor: '#16213e',
                    padding: { x: 40, y: 15 }
                }).setOrigin(0.5);
                
                backButton.setInteractive({ useHandCursor: true });
                
                backButton.on('pointerover', () => {
                    backButton.setStyle({ backgroundColor: '#0f3460' });
                });
                
                backButton.on('pointerout', () => {
                    backButton.setStyle({ backgroundColor: '#16213e' });
                });
                
                backButton.on('pointerdown', () => {
                    this.scene.start('Start');
                });
            }
        }
    </script>
    
    <script>
        class Pause extends Phaser.Scene {
            constructor() {
                super({ key: 'Pause' });
            }

            preload() {
                // No assets needed
            }

            create() {
                const centerX = this.cameras.main.width / 2;
                const centerY = this.cameras.main.height / 2;
                
                // Semi-transparent overlay
                const overlay = this.add.rectangle(0, 0, this.cameras.main.width, this.cameras.main.height, 0x000000, 0.7);
                overlay.setOrigin(0, 0);
                
                // Title
                this.add.text(centerX, centerY - 100, 'PAUSED', {
                    fontSize: '64px',
                    fill: '#fff',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                // Continue button
                const continueButton = this.add.text(centerX, centerY + 20, 'CONTINUE', {
                    fontSize: '32px',
                    fill: '#fff',
                    backgroundColor: '#16213e',
                    padding: { x: 40, y: 15 }
                }).setOrigin(0.5);
                
                continueButton.setInteractive({ useHandCursor: true });
                
                continueButton.on('pointerover', () => {
                    continueButton.setStyle({ backgroundColor: '#0f3460' });
                });
                
                continueButton.on('pointerout', () => {
                    continueButton.setStyle({ backgroundColor: '#16213e' });
                });
                
                continueButton.on('pointerdown', () => {
                    this.scene.stop();
                    this.scene.resume('Main');
                });
                
                // Menu button
                const menuButton = this.add.text(centerX, centerY + 100, 'MENU', {
                    fontSize: '28px',
                    fill: '#fff',
                    backgroundColor: '#16213e',
                    padding: { x: 40, y: 15 }
                }).setOrigin(0.5);
                
                menuButton.setInteractive({ useHandCursor: true });
                
                menuButton.on('pointerover', () => {
                    menuButton.setStyle({ backgroundColor: '#0f3460' });
                });
                
                menuButton.on('pointerout', () => {
                    menuButton.setStyle({ backgroundColor: '#16213e' });
                });
                
                menuButton.on('pointerdown', () => {
                    this.scene.stop('Pause');
                    this.scene.stop('Main');
                    
                    // Stop music
                    const mainScene = this.scene.get('Main');
                    if (mainScene.bgMusic) {
                        mainScene.bgMusic.stop();
                    }
                    
                    this.scene.start('Start');
                });
                
                // ESC untuk resume
                const escKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ESC);
                escKey.on('down', () => {
                    this.scene.stop('Pause');
                    this.scene.resume('Main');
                    
                    // Resume music
                    const mainScene = this.scene.get('Main');
                    if (mainScene.bgMusic) {
                        mainScene.bgMusic.resume();
                    }
                });
            }
        }
    </script>
    
    <script>
        class Main extends Phaser.Scene {
            constructor() {
                super({ key: 'Main' });
            }

            preload() {
                this.load.image('player', 'assets/Pesawat.png');
                this.load.image('enemy', 'assets/Musuh.png');
                this.load.image('heart', 'assets/Hati.png');
                this.load.image('rocket', 'assets/Roket.png');
                this.load.image('bomb', 'assets/BomTim.png');
                this.load.image('turret', 'assets/MeriamAlien.png');
                this.load.image('turretBullet', 'assets/MeriamKotak.png');
                this.load.image('cloud', 'assets/Awan.png');
                this.load.image('background', 'assets/BackgroundGame.png');
                this.load.image('pauseButton', 'assets/TombolPause.png');
                this.load.audio('bgMusic', 'assets/Music.mp3');
            }

            create() {
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // Background image
                this.background = this.add.image(width / 2, height / 2, 'background');
                this.background.setDisplaySize(width, height);
                this.background.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                this.background.setDepth(-10);
                
                // Background Music
                if (!this.sound.get('bgMusic')) {
                    this.bgMusic = this.sound.add('bgMusic', {
                        loop: true,
                        volume: 0.5
                    });
                    this.bgMusic.play();
                } else {
                    this.bgMusic = this.sound.get('bgMusic');
                }
                
                // Player (Pesawat)
                const playerStartY = height / 2;
                this.player = this.physics.add.sprite(width / 2, playerStartY, 'player');
                this.player.setCollideWorldBounds(true);
                this.player.setScale(2);
                
                // FIX GARIS HITAM - Set Pixel Perfect
                this.player.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                
                // Body - Adjusted untuk pesawat
                this.player.body.setSize(40, 30);
                this.player.body.setOffset(12, 17);
                this.player.body.setBounce(0.1);
                
                this.cursors = this.input.keyboard.createCursorKeys();
                
                // UI - Heart dan Score
                this.hearts = [];
                for (let i = 0; i < 3; i++) {
                    const heart = this.add.sprite(30 + (i * 40), 30, 'heart');
                    heart.setScale(1.5);
                    heart.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                    this.hearts.push(heart);
                }
                
                // Pause Button - di kanan hati terakhir
                this.pauseButton = this.add.sprite(30 + (3 * 40) + 20, 30, 'pauseButton');
                this.pauseButton.setScale(1.5);
                this.pauseButton.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                this.pauseButton.setInteractive({ useHandCursor: true });
                this.pauseButton.setDepth(2000); // Di paling depan
                
                this.pauseButton.on('pointerover', () => {
                    this.pauseButton.setScale(1.6);
                });
                
                this.pauseButton.on('pointerout', () => {
                    this.pauseButton.setScale(1.5);
                });
                
                this.pauseButton.on('pointerdown', () => {
                    if (!this.isGameOver) {
                        console.log('Pause button clicked!');
                        
                        if (!this.isPaused) {
                            // PAUSE
                            this.isPaused = true;
                            
                            // Pause music
                            if (this.bgMusic) {
                                this.bgMusic.pause();
                            }
                            
                            // Pause semua timer
                            this.shootTimer.paused = true;
                            this.bombTimer.paused = true;
                            this.turretTimer.paused = true;
                            this.cloudTimer.paused = true;
                            
                            // Pause semua tween (untuk awan)
                            this.tweens.pauseAll();
                            
                            // Pause physics
                            this.physics.pause();
                            
                            // Launch pause scene
                            this.scene.launch('Pause');
                        } else {
                            // RESUME
                            this.isPaused = false;
                            
                            // Stop pause scene
                            this.scene.stop('Pause');
                            
                            // Resume semua timer
                            this.shootTimer.paused = false;
                            this.bombTimer.paused = false;
                            this.turretTimer.paused = false;
                            this.cloudTimer.paused = false;
                            
                            // Resume semua tween
                            this.tweens.resumeAll();
                            
                            // Resume physics
                            this.physics.resume();
                            
                            // Resume music
                            if (this.bgMusic) {
                                this.bgMusic.resume();
                            }
                        }
                    }
                });
                
                this.score = 0;
                this.scoreText = this.add.text(16, 55, 'Score: 0', {
                    fontSize: '24px',
                    fill: '#fff'
                });
                
                // Lives system
                this.lives = 3;
                
                // Rockets group
                this.rockets = this.physics.add.group();
                
                // Bombs group
                this.bombs = this.physics.add.group();
                
                // Clouds group
                this.clouds = this.physics.add.group();
                
                // Clouds group
                this.clouds = this.physics.add.group();
                
                // Turrets group
                this.turrets = this.physics.add.group();
                
                // Turret bullets group
                this.turretBullets = this.physics.add.group();
                
                // Track collected bombs untuk prevent double collision
                this.collectedBombs = new Set();
                
                // Collision roket dengan player (setup sekali aja di create)
                this.physics.add.overlap(this.rockets, this.player, this.hitPlayer, null, this);
                
                // Collision bomb dengan player
                this.physics.add.overlap(this.bombs, this.player, this.collectBomb, null, this);
                
                // Collision turret bullets dengan player
                this.physics.add.overlap(this.turretBullets, this.player, this.hitPlayer, null, this);
                
                // JANGAN spawn enemy di awal - tunggu score 50
                
                // Timer untuk musuh menembak
                this.shootTimer = this.time.addEvent({
                    delay: 2000, // Tembak setiap 2 detik
                    callback: this.enemyShoot,
                    callbackScope: this,
                    loop: true
                });
                
                // Timer untuk spawn bomb
                this.bombTimer = this.time.addEvent({
                    delay: 5000, // Spawn bomb setiap 5 detik
                    callback: this.spawnBomb,
                    callbackScope: this,
                    loop: true
                });
                
                // Timer untuk spawn turret
                this.turretTimer = this.time.addEvent({
                    delay: 8000, // Spawn turret setiap 8 detik
                    callback: this.spawnTurret,
                    callbackScope: this,
                    loop: true
                });
                
                // Timer untuk spawn cloud
                this.cloudTimer = this.time.addEvent({
                    delay: 6000, // Spawn cloud setiap 6 detik
                    callback: this.spawnCloud,
                    callbackScope: this,
                    loop: true
                });
                
                // Flag untuk game over
                this.isGameOver = false;
                
                // Flag untuk pause
                this.isPaused = false;
                
                // Difficulty system
                this.lastScoreMilestone = 0;
                this.enemyCount = 0; // Mulai tanpa musuh
                this.enemies = []; // Array untuk simpan banyak musuh
            }
            
            spawnEnemy() {
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // Spawn musuh dari kanan dengan posisi Y random
                const enemyX = width + 100;
                const enemyY = Phaser.Math.Between(height * 0.2, height * 0.8);
                
                const enemy = this.physics.add.sprite(enemyX, enemyY, 'enemy');
                enemy.setScale(2);
                enemy.setFlipX(false);
                
                // Set pixel perfect
                enemy.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                
                // Body musuh
                enemy.body.setSize(40, 30);
                enemy.body.setOffset(12, 17);
                
                // Target posisi musuh (kanan tengah layar)
                const enemyTargetX = width - 150;
                const enemyTargetY = enemyY;
                
                // Simpan target di data musuh
                enemy.setData('targetX', enemyTargetX);
                enemy.setData('targetY', enemyTargetY);
                
                // Kecepatan musuh bertambah sesuai score
                const baseSpeed = 200;
                const speedMultiplier = 1 + (Math.floor(this.score / 200) * 0.5); // +50% setiap 200 score
                const speed = baseSpeed * speedMultiplier;
                
                // Gerakkan musuh ke posisi target
                this.physics.moveTo(enemy, enemyTargetX, enemyTargetY, speed);
                
                // Tambah ke array enemies
                this.enemies.push(enemy);
            }
            
            spawnBomb() {
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // Spawn bomb dari kanan dengan posisi Y random
                const bombX = width + 50;
                const bombY = Phaser.Math.Between(100, height - 100);
                
                const bomb = this.bombs.create(bombX, bombY, 'bomb');
                bomb.setScale(1.5);
                bomb.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                
                // Bomb bergerak ke kiri
                bomb.setVelocityX(-200);
            }
            
            spawnCloud() {
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                // Spawn cloud dari kanan dengan posisi Y random
                const cloudX = width + 50;
                const cloudY = Phaser.Math.Between(100, height - 100);
                
                const cloud = this.add.sprite(cloudX, cloudY, 'cloud'); // Pakai add.sprite bukan physics
                cloud.setScale(2);
                cloud.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                cloud.setDepth(-1); // Di belakang player
                
                // Animasi cloud bergerak ke kiri (pakai tween bukan physics)
                this.tweens.add({
                    targets: cloud,
                    x: -100,
                    duration: 8000,
                    ease: 'Linear',
                    onComplete: () => {
                        cloud.destroy();
                    }
                });
            }
            
            increaseDifficulty(milestone) {
                console.log('Difficulty increased at score:', milestone);
                
                if (milestone === 50) {
                    // Score 50: Spawn 1 musuh pertama kali
                    this.enemyCount = 1;
                    this.spawnEnemy();
                } else if (milestone === 100) {
                    // Score 100: MeriamAlien mulai spawn
                    // Turret sudah spawn dari awal, jadi cuma kasih notif
                    console.log('MeriamAlien now active!');
                } else if (milestone % 50 === 0) {
                    // Setiap 50 score setelah itu
                    if (milestone === 150 || milestone === 250 || milestone === 350) {
                        // 150, 250, 350: Tambah 1 musuh lagi
                        this.enemyCount++;
                        this.spawnEnemy();
                    }
                    // Score 200, 300, 400, dst: Musuh makin cepat (sudah handled di spawn & shoot)
                }
            }
            
            spawnTurret() {
                const width = this.cameras.main.width;
                
                // Spawn turret dari atas dengan posisi X random
                const turretX = Phaser.Math.Between(100, width - 100);
                const turretY = 0;
                
                const turret = this.turrets.create(turretX, turretY, 'turret');
                turret.setScale(1.5);
                turret.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                turret.setOrigin(0.5, 0);
                
                // Turret diam di posisi (tidak bergerak)
                turret.body.setImmovable(true);
                turret.body.setAllowGravity(false);
                
                // Simpan data untuk tracking
                turret.setData('shootTimer', 0);
            }
            
            turretShoot(turret) {
                if (turret && turret.active) {
                    // Buat peluru dari posisi turret
                    const bullet = this.turretBullets.create(turret.x, turret.y + 30, 'turretBullet');
                    bullet.setScale(1.5);
                    bullet.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                    
                    // Set velocity peluru ke bawah
                    bullet.setVelocityY(250);
                    
                    // Hancurkan turret setelah nembak
                    turret.destroy();
                }
            }
            
            collectBomb(player, bomb) {
                // Prevent double collision
                if (this.collectedBombs.has(bomb)) {
                    return;
                }
                this.collectedBombs.add(bomb);
                
                // Hancurkan bomb immediately
                bomb.disableBody(true, true);
                
                // Hancurkan SEMUA musuh
                if (this.enemies.length > 0) {
                    // Stop musuh nembak sementara
                    this.shootTimer.paused = true;
                    
                    this.enemies.forEach(enemy => {
                        if (enemy && enemy.active) {
                            // Disable physics musuh dulu
                            enemy.body.enable = false;
                            
                            // Efek visual musuh meledak
                            this.tweens.add({
                                targets: enemy,
                                alpha: 0,
                                scale: 3,
                                duration: 300,
                                onComplete: () => {
                                    if (enemy) {
                                        enemy.destroy();
                                    }
                                }
                            });
                        }
                    });
                    
                    // Clear array musuh
                    this.enemies = [];
                    
                    // Spawn musuh baru setelah 3 detik sesuai jumlah saat ini
                    this.time.delayedCall(3000, () => {
                        for (let i = 0; i < this.enemyCount; i++) {
                            this.spawnEnemy();
                        }
                        this.shootTimer.paused = false;
                    });
                }
                
                // Efek visual shake
                this.cameras.main.shake(200, 0.01);
                
                // Hapus dari tracking set
                this.time.delayedCall(100, () => {
                    this.collectedBombs.delete(bomb);
                });
            }
            
            enemyShoot() {
                // Semua musuh nembak
                this.enemies.forEach(enemy => {
                    if (enemy && enemy.active && enemy.body && enemy.body.enable) {
                        // Buat roket dari posisi musuh
                        const rocket = this.rockets.create(enemy.x - 30, enemy.y, 'rocket');
                        rocket.setScale(1.5);
                        rocket.texture.setFilter(Phaser.Textures.FilterMode.NEAREST);
                        
                        // Set velocity roket ke kiri (lebih cepat sesuai score)
                        const baseSpeed = 300;
                        const speedMultiplier = 1 + (Math.floor(this.score / 200) * 0.3);
                        rocket.setVelocityX(-baseSpeed * speedMultiplier);
                    }
                });
            }
            
            hitPlayer(player, rocket) {
                // Hancurkan roket
                rocket.destroy();
                
                // Kurangi nyawa
                this.lives--;
                
                // Hapus satu hati dari display
                if (this.hearts.length > 0) {
                    const heart = this.hearts.pop();
                    heart.destroy();
                }
                
                // Cek game over hanya kalau nyawa habis
                if (this.lives <= 0) {
                    this.gameOver();
                } else {
                    // Tambah efek invincible sebentar
                    this.player.setAlpha(0.5);
                    this.time.delayedCall(1000, () => {
                        this.player.setAlpha(1);
                    });
                }
            }
            
            gameOver() {
                // Set flag game over
                this.isGameOver = true;
                
                // Pause physics
                this.physics.pause();
                
                // Stop semua timer
                this.shootTimer.remove();
                this.bombTimer.remove();
                this.turretTimer.remove();
                this.cloudTimer.remove();
                
                // Stop semua tween (untuk awan)
                this.tweens.killAll();
                
                // Pause music
                if (this.bgMusic) {
                    this.bgMusic.pause();
                }
                
                const width = this.cameras.main.width;
                const height = this.cameras.main.height;
                
                this.add.text(width / 2, height / 2, 'GAME OVER', {
                    fontSize: '64px',
                    fill: '#ff0000',
                    fontStyle: 'bold'
                }).setOrigin(0.5);
                
                this.add.text(width / 2, height / 2 + 80, 'Press R to Restart', {
                    fontSize: '24px',
                    fill: '#fff'
                }).setOrigin(0.5);
                
                this.add.text(width / 2, height / 2 + 120, 'Press M for Menu', {
                    fontSize: '24px',
                    fill: '#fff'
                }).setOrigin(0.5);
                
                // R untuk restart
                this.input.keyboard.once('keydown-R', () => {
                    if (this.bgMusic) {
                        this.bgMusic.stop();
                    }
                    this.scene.restart();
                });
                
                // M untuk menu
                this.input.keyboard.once('keydown-M', () => {
                    if (this.bgMusic) {
                        this.bgMusic.stop();
                    }
                    this.scene.start('Start');
                });
            }

            update() {
                // Stop update kalau game over atau paused
                if (this.isGameOver || this.isPaused) {
                    return;
                }
                
                // Kecepatan normal dan boost
                const normalSpeed = 200;
                const boostSpeed = 400;
                const speed = this.input.keyboard.addKey('SHIFT').isDown ? boostSpeed : normalSpeed;
                
                // Movement kiri-kanan
                if (this.cursors.left.isDown) {
                    this.player.body.setVelocityX(-speed);
                    this.player.setFlipX(true);
                } else if (this.cursors.right.isDown) {
                    this.player.body.setVelocityX(speed);
                    this.player.setFlipX(false);
                } else {
                    this.player.body.setVelocityX(0);
                }
                
                // Movement atas-bawah
                if (this.cursors.up.isDown) {
                    this.player.body.setVelocityY(-speed);
                } else if (this.cursors.down.isDown) {
                    this.player.body.setVelocityY(speed);
                } else {
                    this.player.body.setVelocityY(0);
                }
                
                // Update score berdasarkan waktu terbang
                this.score += 0.1;
                this.scoreText.setText('Score: ' + Math.floor(this.score));
                
                // Check difficulty milestones setiap 50 score
                const currentMilestone = Math.floor(this.score / 50) * 50;
                if (currentMilestone > this.lastScoreMilestone && currentMilestone > 0) {
                    this.lastScoreMilestone = currentMilestone;
                    this.increaseDifficulty(currentMilestone);
                }
                
                // Enemy AI - Naik turun mengikuti player
                this.enemies.forEach(enemy => {
                    if (enemy && enemy.active && enemy.body && enemy.body.enable) {
                        const targetX = enemy.getData('targetX');
                        
                        // Cek apakah musuh sudah sampai posisi target horizontal
                        const reachedTarget = enemy.x <= targetX;
                        
                        if (reachedTarget) {
                            // Sudah sampai, stop horizontal movement
                            enemy.body.setVelocityX(0);
                            enemy.x = targetX;
                            
                            // Track player secara vertikal dengan deadzone
                            const baseSpeed = 150;
                            const speedMultiplier = 1 + (Math.floor(this.score / 200) * 0.5);
                            const enemySpeed = baseSpeed * speedMultiplier;
                            const deadzone = 20;
                            const yDiff = this.player.y - enemy.y;
                            
                            if (yDiff < -deadzone) {
                                // Player di ATAS musuh, musuh NAIK
                                enemy.body.setVelocityY(-enemySpeed);
                            } else if (yDiff > deadzone) {
                                // Player di BAWAH musuh, musuh TURUN
                                enemy.body.setVelocityY(enemySpeed);
                            } else {
                                // Sudah cukup dekat, STOP
                                enemy.body.setVelocityY(0);
                            }
                        }
                    }
                });
                
                // Hapus roket yang keluar layar
                this.rockets.children.entries.forEach(rocket => {
                    if (rocket.x < -50) {
                        rocket.destroy();
                    }
                });
                
                // Hapus bomb yang keluar layar
                this.bombs.children.entries.forEach(bomb => {
                    if (bomb.x < -50) {
                        bomb.destroy();
                    }
                });
                
                // Update turrets - tembak setiap 2 detik
                this.turrets.children.entries.forEach(turret => {
                    if (turret.active) {
                        let timer = turret.getData('shootTimer') || 0;
                        timer += 1;
                        turret.setData('shootTimer', timer);
                        
                        // Tembak setiap 120 frames (sekitar 2 detik di 60fps)
                        if (timer >= 120) {
                            this.turretShoot(turret);
                            turret.setData('shootTimer', 0);
                        }
                    }
                });
                
                // Hapus turret bullets yang keluar layar
                this.turretBullets.children.entries.forEach(bullet => {
                    if (bullet.y > this.cameras.main.height + 50) {
                        bullet.destroy();
                    }
                });
            }
        }
    </script>
    
    <script>
        window.addEventListener('load', function() {
            // Hitung tinggi game (total height - ad height)
            const adHeight = 90;
            const gameHeight = window.innerHeight - adHeight;
            
            const config = {
                type: Phaser.AUTO,
                scale: {
                    mode: Phaser.Scale.RESIZE,
                    parent: 'game-container',
                    width: window.innerWidth,
                    height: gameHeight,
                    autoCenter: Phaser.Scale.CENTER_BOTH
                },
                backgroundColor: '#2d2d2d',
                render: {
                    pixelArt: true,
                    antialias: false
                },
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 0 },
                        debug: false
                    }
                },
                scene: [Start, Settings, Pause, Main]
            };
            
            const game = new Phaser.Game(config);
            
            window.addEventListener('resize', () => {
                const newGameHeight = window.innerHeight - adHeight;
                game.scale.resize(window.innerWidth, newGameHeight);
            });
        });
    </script>
</body>
</html>